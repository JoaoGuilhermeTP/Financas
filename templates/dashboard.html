{% extends "layout.html" %} {% block content %}
<div class="dashboard-section">
  <h2>Saldos das Contas</h2>
  <div class="accounts-list">
    {% for account in accounts %}
    <div class="account-item">
      <span class="account-name">{{ account.account_name }}</span>
      <span class="account-balance"
        >R$ {{ '%.2f'|format(account.balance) }}</span
      >
    </div>
    {% endfor %}
  </div>
  <div class="total-balance">
    <strong>Total:</strong> R$ {{ '%.2f'|format(total_balance) }}
  </div>
  <canvas id="accountsBarChart" width="600" height="300"></canvas>
</div>

<div class="dashboard-section">
  <h2>Projeção de Saldo por Conta (Próximos 12 meses)</h2>
  <canvas id="projectionLineChart" width="700" height="350"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const lineColors = [
      '#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#E91E63', '#00BCD4', '#FF5722', '#607D8B', '#795548', '#8BC34A', '#FFC107', '#3F51B5'
  ];
  const accountNames = {{ accounts|map(attribute='account_name')|list|tojson }};
  const accountBalances = {{ accounts|map(attribute='balance')|list|tojson }};
  const barColors = accountNames.map((_, idx) => lineColors[idx % lineColors.length]);
  new Chart(document.getElementById('accountsBarChart').getContext('2d'), {
      type: 'bar',
      data: {
          labels: accountNames,
          datasets: [{
              label: 'Saldo por Conta',
              data: accountBalances,
              backgroundColor: barColors,
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: { display: false },
              title: { display: false }
          },
          scales: {
              y: {
                  beginAtZero: true,
                  ticks: {
                      callback: function(value) {
                          return 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                      }
                  }
              }
          }
      }
  });
  const projectionLabels = {{ projection_labels|tojson }};
  const projectionData = {{ projection_data|tojson }};
  const datasets = projectionData.map((acc, idx) => ({
      label: acc.account_name,
      data: acc.balances,
      borderColor: lineColors[idx % lineColors.length],
      backgroundColor: lineColors[idx % lineColors.length],
      fill: false,
      tension: 0.2
  }));
  new Chart(document.getElementById('projectionLineChart').getContext('2d'), {
      type: 'line',
      data: {
          labels: projectionLabels,
          datasets: datasets
      },
      options: {
          responsive: true,
          plugins: {
              legend: { position: 'top' },
              title: { display: false }
          },
          scales: {
              y: {
                  beginAtZero: false,
                  ticks: {
                      callback: function(value) {
                          return 'R$ ' + value.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                      }
                  }
              }
          }
      }
  });
</script>
<style>
  .dashboard-section {
    max-width: 700px;
    margin: 2rem auto;
    background: #fff;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px #0001;
  }
  .accounts-list {
    margin-bottom: 1rem;
  }
  .account-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
  }
  .account-name {
    font-weight: 500;
  }
  .account-balance {
    font-family: monospace;
  }
  .total-balance {
    margin: 1rem 0;
    font-size: 1.2rem;
    text-align: right;
  }
</style>
{% endblock content %}
