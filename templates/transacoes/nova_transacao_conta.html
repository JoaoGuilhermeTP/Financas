{% extends "layout.html" %}

{% block content %}
<div class="form-container">
    <h2>Adicionar Transação à Conta Corrente</h2>
    {% if error %}<p style="color:red;">{{ error }}</p>{% endif %}
    <form class="form" method="POST" action="/transacoes/nova/conta">
        <div class="form-group">
            <label for="descricao">Descrição</label>
            <input type="text" id="descricao" name="descricao" required>
        </div>
        <div class="form-group">
            <label for="tipo">Tipo</label>
            <select id="tipo" name="tipo" required>
                <option value="receita">Receita</option>
                <option value="despesa">Despesa</option>
            </select>
        </div>
        <div class="form-group">
            <label for="valor">Valor</label>
            <input type="text" id="valor" name="valor" required inputmode="numeric">
        </div>
        <div class="form-group">
            <label for="data">Data</label>
            <input type="date" id="data" name="data" required>
        </div>
        <div class="form-group">
            <label for="conta_id">Conta Corrente</label>
            <select id="conta_id" name="conta_id" required>
                <option value="">Selecione uma conta</option>
                {% for conta in contas %}
                    <option value="{{ conta.id }}">{{ conta.account_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="category_id">Categoria</label>
            <select id="category_id" name="category_id" required>
                <option value="">Selecione uma categoria</option>
                {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="status">Status</label>
            <select id="status" name="status" required>
                <option value="Confirmado">Confirmado</option>
                <option value="Previsto">Previsto</option>
            </select>
        </div>
        <button type="submit" class="btn">Adicionar Transação</button>
    </form>
</div>
<script>
function formatarMoeda(input) {
    let v = input.value.replace(/\D/g, "");
    v = (v/100).toFixed(2) + '';
    v = v.replace('.', ',');
    v = v.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
    input.value = v;
}
const valorInput = document.getElementById('valor');
const tipoInput = document.getElementById('tipo');
if (valorInput && tipoInput) {
    valorInput.addEventListener('input', function() { formatarMoeda(this); });
    valorInput.form.addEventListener('submit', function(e) {
        let raw = valorInput.value.replace(/\./g, '').replace(',', '.');
        let val = parseFloat(raw).toFixed(2);
        if (tipoInput.value === 'despesa' && val > 0) {
            val = '-' + val;
        }
        if (tipoInput.value === 'receita' && val < 0) {
            val = Math.abs(val).toFixed(2);
        }
        valorInput.value = val;
    });
}
</script>
{% endblock content %}
